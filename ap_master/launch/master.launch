<launch>
  <arg name="gps" default="true" />

  <arg name="gps_arg" default="--gps-time-hack" if="$(arg gps)" />
  <arg name="gps_arg" default="" unless="$(arg gps)" />
  <arg name="ctrlr" default="1" />  <!-- Run the controller nodes -->

  <arg name="subswarm" default="0" />

  <param name="aircraft_id" type="int" value="$(arg id)" />
  <param name="subswarm_id" type="int" value="$(arg subswarm)" />
  <param name="aircraft_name" type="str" value="$(arg name)" />
  <param name="rosbag_enable" type="bool" value="true" />

  <node name="autopilot" pkg="autopilot_bridge" type="mavbridge.py" output="screen" args="--module acs --module param --module slave --module wp $(arg gps_arg)" />
  <node name="safety" pkg="ap_safety_monitor" type="safety.py" output="screen" >
    <remap from="safety/heartbeat" to="autopilot/heartbeat_onboard" />
  </node>
  <node name="network" pkg="ap_network_bridge" type="aerial.py" output="screen" args="--device wlan0" >
    <remap from="network/send_flight_status" to="autopilot/status" />
    <remap from="network/send_pose" to="autopilot/acs_pose" />
    <remap from="network/recv_heart_ground" to="autopilot/heartbeat_ground" />
    <remap from="network/recv_arm" to="autopilot/arm" />
    <remap from="network/recv_mode" to="autopilot/mode_num" />
    <remap from="network/recv_land" to="autopilot/land" />
    <remap from="network/recv_land_abort" to="autopilot/land_abort" />
    <remap from="network/recv_guided_goto" to="autopilot/guided_goto" />
    <remap from="network/recv_waypoint_goto" to="autopilot/waypoint_goto" />
    <remap from="network/update_subswarm" to="swarm_tracker/update_subswarm" />
  </node>
  <node name="swarm_tracker" pkg="ap_perception" type="swarm_tracker_node.py" output="screen" args="" >
    <remap from="swarm_tracker/acs_pose" to="autopilot/acs_pose" />
    <remap from="swarm_tracker/recv_pose" to="network/recv_pose" />
  </node>
  <group if="$(arg ctrlr)">
    <node name="follower" pkg="ap_path_planning" type="follower_node.py" output="screen" args="">
      <remap from="follower/payload_waypoint" to="autopilot/payload_waypoint" />
      <remap from="follower/status" to="controllers/status" />
      <remap from="follower/swarm_state" to="swarm_tracker/swarm_state" />
      <remap from="follower/follower_set" to="controllers/follower_set" />
    </node>
    <node name="wp_sequencer" pkg="ap_path_planning" type="wp_sequencer_node.py" output="screen" args="">
      <remap from="wp_sequencer/payload_waypoint" to="autopilot/payload_waypoint" />
      <remap from="wp_sequencer/status" to="controllers/status" />
      <remap from="wp_sequencer/acs_pose" to="autopilot/acs_pose" />
      <remap from="wp_sequencer/wp_sequencer_set" to="controllers/wp_sequencer_set" />
    </node>
    <node name="ctlr_selector" pkg="ap_mission_planning" type="ctlr_select.py" output="screen" args="" />
  </group>
  <node name="run_once" pkg="ap_tasks" type="run_once.py" output="screen" args="" />
</launch>
